!function(a){a&&(a.Model=Class.create({idAttribute:"id",urlRoot:null,initialize:function(a){a=a||{},this._attributes={},this._dirtyAttributes={},this.set(a)},getId:function(){return this[this.idAttribute]||null},setId:function(a){return this[this.idAttribute]=a||null,this._attributes[this.idAttribute]=a||null,this},set:function(a,b){var c;return a instanceof Object?$H(a).each(function(a){c=this.set(a.key,a.value)},this):c=this.setAttribute(a,b),c},setAttribute:function(a,b){return"string"==typeof a&&(this._attributes[a]=b,this._dirtyAttributes[a]=b,a===this.idAttribute&&this.setId(b)),this},get:function(a){return a?this.hasAttribute(a)?this._attributes[a]:null:Object.clone(this._attributes)},url:function(){var a=this.urlRoot;if(!a)throw new Error("urlRoot not set. Please define an urlRoot in your model.");return this.getId()&&(a+="/"+String(this.getId())),a},save:function(a){var b=this.url(),c=this.getId()?"update":"create";return this._request(b,c,a)},fetch:function(a){if(!this.getId())throw new Error("Cannot be called for new Models");var b=this.url(),c="read";return this._request(b,c,a)},destroy:function(a){if(!this.getId())throw new Error("Cannot be called for new Models");var b=this.url(),c="delete";return this._request(b,c,a)},_request:function(a,b,c){var d={};return c=c||{},Object.extend(d,{onSuccess:function(a){return function(b){this.parse(b),a instanceof Function&&a(b,this)}.bind(this)}.bind(this)(c.onSuccess)}),this.sync(a,b,this,d)},sync:function(){return a.Model.sync.apply(a.Model,arguments)},parse:function(a){a&&a.responseJSON&&this.set(a.responseJSON)},hasAttribute:function(a){return Object.keys(this._attributes).indexOf(a)>=0}}))}(Prototype),function(a){var b={create:"POST",read:"GET",update:"PUT","delete":"DELETE"},c={create:"POST",read:"GET",update:"POST","delete":"POST"},d=function(a,d){return d?c[a]:b[a]};a&&a.Model&&Object.extend(a.Model,{emulateHTTP:!0,emulateJSON:!1,sync:function(a,c,e,f){var g=d(c,this.emulateHTTP),h={method:g,contentType:"application/json",postBody:Object.toJSON(e.get()),requestHeaders:{}};return this.emulateHTTP&&(h.requestHeaders["X-HTTP-Method-Override"]=b[c]),f=f||{},Object.extend(h,f),new Ajax.Request(a,h)}})}(Prototype);