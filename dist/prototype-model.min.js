Prototype.Model=Class.create({idAttribute:"id",urlRoot:null,initialize:function(a){a=a||{},this._attributes={},this._listeners={},this._dirtyAttributes={},this.set(a)},getId:function(){return this[this.idAttribute]||null},setId:function(a){return this[this.idAttribute]=a||null,this._attributes[this.idAttribute]=a||null,this},set:function(a,b){var c,d={},e={};return a instanceof Object?$H(a).each(function(a){c=this.set(a.key,a.value)},this):(c=this._setAttribute(a,b,e,d),this.fireEvent("updated",this,e,d)),c},_setAttribute:function(a,b,c,d){return"string"==typeof a&&(this._attributes[a]!==b&&(d&&(d[a]=this._dirtyAttributes[a]),c&&(c[a]=b),this._dirtyAttributes[a]=b),this._attributes[a]=b,a===this.idAttribute&&this.setId(b)),this},get:function(a){return a?this.hasAttribute(a)?this._attributes[a]:null:Object.clone(this._attributes)},url:function(){var a=this.urlRoot;if(!a)throw new Error("urlRoot not set. Please define an urlRoot in your model.");return this.getId()&&(a+="/"+String(this.getId())),a},save:function(a){var b=this.url(),c=this.getId()?"update":"create";return this._request(b,c,a)},fetch:function(a){if(!this.getId())throw new Error("Cannot be called for new Models");var b=this.url(),c="read";return this._request(b,c,a)},destroy:function(a){if(!this.getId())throw new Error("Cannot be called for new Models");var b=this.url(),c="delete";return this._request(b,c,a)},_request:function(a,b,c){var d={};return c=c||{},Object.extend(d,{onSuccess:function(a){return function(b){this.parse(b),a instanceof Function&&a(b,this)}.bind(this)}.bind(this)(c.onSuccess)}),this.sync(a,b,this,d)},sync:function(){return Prototype.Model.sync.apply(Prototype.Model,arguments)},parse:function(a){a&&a.responseJSON&&this.set(a.responseJSON)},hasAttribute:function(a){return Object.keys(this._attributes).indexOf(a)>=0},on:function(a,b){return this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push(b),this},off:function(a,b){var c;if(b)for(c=this._listeners[a];c&&c.indexOf(b)>-1;)c.splice(c.indexOf(b),1);else this._listeners[a]=[];return this},fireEvent:function(a){var b=$A(arguments).splice(1),c=!0;return $A(this._listeners[a]).each(function(a){a instanceof Function&&(c=c&&a.apply(null,b)!==!1)}.bind(this)),c}}),function(){var a={create:"post",read:"get",update:"put","delete":"delete"},b={create:"post",read:"get",update:"post","delete":"post"},c=function(c,d){return d?b[c]:a[c]};Prototype&&Prototype.Model&&Object.extend(Prototype.Model,{emulateHTTP:!0,emulateJSON:!1,sync:function(b,d,e,f){var g=c(d,this.emulateHTTP),h={method:g,contentType:"application/json",postBody:Object.toJSON(e.get()),requestHeaders:{}};return this.emulateHTTP&&(h.requestHeaders["X-HTTP-Method-Override"]=a[d]),f=f||{},Object.extend(h,f),new Ajax.Request(b,h)}})}();